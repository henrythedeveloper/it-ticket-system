// src/styles/pages/dashboard/_TicketDetailPage.scss
// ==========================================================================
// Styles specific to the Ticket Detail page.
// Includes main ticket info, sidebar, updates, attachments.
// **REVISED**: Removed modal-specific styles (handled globally).
// ==========================================================================

@use '../../variables' as *;
@use '../../mixins';
// Removed: @use '../../components/common/Modal'; // Base modal styles handled globally now

.ticket-detail-page {
  width: 100%;
  margin-bottom: $spacing-8;

  // --- Page Header ---
  .page-header {
    // ... (styles remain the same) ...
    .header-left {
      display: flex; flex-direction: column;
      .back-button {
        background: none; border: none; color: var(--text-link);
        font-weight: $font-weight-medium; cursor: pointer; padding: 0;
        display: flex; align-items: center; margin-bottom: $spacing-2;
        transition: color $transition-fast;
        &:hover { color: var(--text-link-hover); text-decoration: underline; }
      }
        h1 { color: var(--text-primary); }
    }
  }

  // --- Main Grid Layout (Ticket Content + Sidebar) ---
  .ticket-grid {
    // ... (styles remain the same) ...
    display: grid;
    grid-template-columns: 3fr 1fr;
    gap: $spacing-6;

    @media (max-width: $breakpoint-lg) {
      grid-template-columns: 1fr;
    }

    .ticket-main {
      display: flex; flex-direction: column; gap: $spacing-6;
    }
  }

  // --- Ticket Information Card ---
  .ticket-card {
    // ... (styles remain the same) ...
    @include mixins.card-base;
    padding: $spacing-6;

    .ticket-header {
      margin-bottom: $spacing-4;
      h2 { font-size: $font-size-2xl; color: var(--text-primary); margin-bottom: $spacing-3; transition: color $transition-medium; }
      .ticket-meta { display: flex; gap: $spacing-3; }
    }

    .ticket-body {
      .ticket-description {
        color: var(--text-secondary); line-height: 1.6; white-space: pre-line;
        margin-bottom: $spacing-4; transition: color $transition-medium;
        max-height: 300px; overflow-y: auto; padding-right: $spacing-2;
      }
      .ticket-tags {
        display: flex; flex-wrap: wrap; gap: $spacing-2; margin-bottom: $spacing-4;
        strong { margin-right: $spacing-2; color: var(--text-muted); font-weight: $font-weight-medium; }
        .tag { background-color: var(--surface-alt-bg); color: var(--text-secondary); padding: $spacing-1 $spacing-3; border-radius: $border-radius-full; font-size: $font-size-sm; transition: background-color $transition-medium, color $transition-medium; }
      }
    }

    // --- Attachments Section ---
    .ticket-attachments {
      // ... (styles remain the same) ...
      margin-top: $spacing-6; padding-top: $spacing-4;
      border-top: 1px solid var(--border-color); transition: border-color $transition-medium;

      h3 { 
        font-size: $font-size-lg; 
        color: var(--text-primary); 
        margin-bottom: $spacing-3; 
        transition: color $transition-medium; 
      }
        .no-attachments { 
          color: var(--text-muted); 
          font-style: italic; 
          padding: $spacing-3 0; 
        }
        .attachment-list { 
          list-style: none; 
          padding: 0; 
          margin: $spacing-2 0 0 0; 
        }
        .attachment-item { 
          display: flex; 
          align-items: center; 
          justify-content: space-between; 
          padding: $spacing-2 0; 
          border-bottom: 1px solid var(--border-color); 
          transition: border-color $transition-medium;
          position: relative; 

          &:last-child { 
            border-bottom: none; 
          } 
        }

        // --- Hover Preview Element ---
        .attachment-hover-preview {
          position: absolute;
          bottom: 100%; // Position above the list item
          left: 0; // Align with the left edge of the list item
          margin-bottom: $spacing-2; // Small gap between item and preview
          width: 250px; // Fixed width for preview
          height: 250px; // Fixed height for preview
          background-color: var(--surface-bg);
          border: 1px solid var(--border-color-strong);
          border-radius: $border-radius;
          box-shadow: $shadow-md;
          z-index: 10; // Ensure it appears above sibling list items
          pointer-events: none; // Prevent hover preview from blocking mouse events on the item itself
          display: flex; // Center image inside
          align-items: center;
          justify-content: center;
          overflow: hidden; // Hide parts of image that don't fit

          img {
              display: block;
              max-width: 100%;
              max-height: 100%;
              object-fit: contain; // Show the whole image, scaled down
          }
      }
        .attachment-info { 
          display: flex; 
          align-items: center; 
          gap: $spacing-3; 
          flex-grow: 1; 
          overflow: hidden; 
          pointer-events: auto; 
        }
        .attachment-icon { 
          color: var(--text-muted); 
          flex-shrink: 0; 
          width: 40px; 
          text-align: center; 
          pointer-events: none; 
        }
        .attachment-thumbnail { 
          width: 40px; 
          height: 40px; 
          object-fit: cover; 
          border-radius: $border-radius-sm; 
          border: 1px solid var(--border-color); 
          cursor: pointer; 
          flex-shrink: 0; 
          transition: transform 0.2s ease, 
          box-shadow 0.2s ease; 
          pointer-events: auto;

          &:hover { 
            transform: scale(1.1); 
            box-shadow: $shadow; 
        } 
      }
        .attachment-filename { 
          color: var(--text-secondary); 
          font-size: $font-size-sm; 
          white-space: nowrap; 
          overflow: hidden; 
          text-overflow: ellipsis; 
          flex-grow: 1; 
          pointer-events: none; 
        }

        .attachment-size { 
          color: var(--text-muted); 
          font-size: $font-size-xs; 
          white-space: nowrap; 
          margin-left: $spacing-2; 
          flex-shrink: 0; 
          pointer-events: none; 
        }

        .attachment-actions { 
          display: flex; 
          align-items: center; 
          gap: $spacing-2; 
          flex-shrink: 0; 
          margin-left: $spacing-3; 
          pointer-events: auto; 
          
          & > * { 
            pointer-events: auto; 
          } 
        }

        .download-icon-btn, .delete-icon-btn { 
          background: none; 
          border: none; 
          cursor: pointer; 
          padding: $spacing-1; 
          color: var(--text-muted); 
          transition: color $transition-fast; 
          line-height: 1; 

          &:hover { 
            color: var(--primary); 
        } 
      }

        .delete-icon-btn { 
          &:hover { 
          color: var(--error); 
        } 
        &:disabled { 
          color: var(--text-muted); 
          opacity: 0.5; cursor: not-allowed; 
        } 
      }
    } // End .ticket-attachments

    // --- Resolution Notes Section ---
    .resolution-notes {
      // ... (styles remain the same) ...
      margin-top: $spacing-6; padding-top: $spacing-4;
      border-top: 1px solid var(--border-color); transition: border-color $transition-medium;
      h3 { font-size: $font-size-lg; color: var(--text-primary); margin-bottom: $spacing-3; transition: color $transition-medium; }
      p { color: var(--text-secondary); line-height: 1.5; transition: color $transition-medium; white-space: pre-line; }
    }
  } // End .ticket-card

  // --- Ticket Updates/Comments Section ---
  .ticket-updates {
    // ... (styles remain the same) ...
    @include mixins.card-base;
    padding: $spacing-6; display: flex; flex-direction: column;

    .updates-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: $spacing-4; border-bottom: 1px solid var(--border-color);
      padding-bottom: $spacing-3; transition: border-color $transition-medium;
      flex-shrink: 0;
      h3 { font-size: $font-size-lg; color: var(--text-primary); margin: 0; transition: color $transition-medium; }
      .add-comment-btn { padding: $spacing-2 $spacing-3; font-size: $font-size-sm; }
    }

    .comment-form-container, .status-form-container {
      background-color: var(--surface-alt-bg); border-radius: $border-radius;
      padding: $spacing-4; margin-bottom: $spacing-4;
      border: 1px solid var(--border-color-strong);
      transition: background-color $transition-medium, border-color $transition-medium;
      flex-shrink: 0;

      h4 { font-size: $font-size-base; color: var(--text-primary); margin-bottom: $spacing-3; transition: color $transition-medium; }
      .comment-form, .status-form {
        .form-group { margin-bottom: $spacing-3; textarea { min-height: 100px; } }
      }
    }

    .updates-timeline {
      max-height: 50vh;
      overflow-y: auto; flex-grow: 1;

      .update-item {
        padding: $spacing-4 0 $spacing-4 $spacing-5; border-left: 3px solid var(--border-color);
        margin-left: $spacing-2; margin-bottom: $spacing-4; position: relative;
        transition: border-color $transition-medium;
        &:before {
          content: ''; position: absolute; width: 12px; height: 12px;
          background-color: var(--border-color-strong); border-radius: 50%;
          left: -7.5px; top: $spacing-4; border: 2px solid var(--surface-bg);
          transition: background-color $transition-medium, border-color $transition-medium;
        }
        &:last-child { margin-bottom: 0; border-left-color: transparent; }

        &.system-update { background-color: rgba(var(--text-muted-rgb, 107, 114, 128), 0.03); border-left-color: var(--border-color-strong);
          &:before { background-color: var(--text-muted); }
          .update-author strong { font-style: italic; }
        }
        &.internal-note { border-left-color: var(--accent); background-color: rgba(var(--accent-rgb), 0.05);
          &:before { background-color: var(--accent); }
          .update-author .internal-badge { background-color: var(--accent-light); color: var(--text-inverted); font-size: $font-size-xs; padding: 2px $spacing-1; border-radius: $border-radius-sm; margin-left: $spacing-2; }
        }

        .update-header { display: flex; justify-content: space-between; margin-bottom: $spacing-2;
          .update-author { font-weight: $font-weight-medium; color: var(--text-primary); display: flex; align-items: center; transition: color $transition-medium; }
          .update-time { font-size: $font-size-sm; color: var(--text-muted); transition: color $transition-medium; }
        }
        .update-content { color: var(--text-secondary); line-height: 1.5; white-space: pre-line; transition: color $transition-medium; }
      }

      .no-updates { color: var(--text-muted); text-align: center; padding: $spacing-6; font-style: italic; }
    }
  } // End .ticket-updates

  // --- Sidebar Section ---
  .ticket-sidebar {
    // ... (styles remain the same) ...
    display: flex; flex-direction: column; gap: $spacing-6;
    .sidebar-card {
      @include mixins.card-base; padding: $spacing-4;

      h3 {
        font-size: $font-size-lg; color: var(--text-primary); margin-bottom: $spacing-4;
        padding-bottom: $spacing-2; border-bottom: 1px solid var(--border-color);
        transition: color $transition-medium, border-color $transition-medium;
      }
      .info-group { display: flex; margin-bottom: $spacing-3;
        label { width: 120px; font-weight: $font-weight-medium; color: var(--text-muted); transition: color $transition-medium; flex-shrink: 0; }
        span { flex-grow: 1; color: var(--text-secondary); transition: color $transition-medium;
        }
      }
      .sidebar-actions { display: flex; flex-direction: column; gap: $spacing-3;
        .file-upload-container { position: relative;
          .file-upload-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 0.5rem 0.75rem;
            text-align: center;
            background-color: var(--surface-alt-bg);
            color: var(--text-secondary);
            border: 1px dashed var(--border-color-strong);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;

            &.disabled { opacity: 0.6; cursor: not-allowed; background-color: var(--surface-tonal-2); border-color: var(--surface-tonal-3); color: var(--text-muted); }
            &:not(.disabled):hover { background-color: var(--surface-bg); border-color: var(--primary); color: var(--primary); }
          }
          .file-input { position: absolute; width: 0.1px; height: 0.1px; opacity: 0; overflow: hidden; z-index: -1; }
        }
        button { width: 100%; }
      }
    }
  } // End .ticket-sidebar

  // --- Badge Styles ---
  .status-badge, .urgency-badge {
    @include mixins.badge-base;
    @include mixins.badge-alpha-variants;
    min-width: 80px;
  }

  // --- Specific Image Preview Modal Styles ---
  // Removed - Styles are now in _Modal.scss and applied via .modal class
  // .image-preview-modal { ... }

} // End .ticket-detail-page

// --- Responsive Adjustments ---
@media (max-width: $breakpoint-md) {
  .ticket-detail-page {
    .ticket-grid { grid-template-columns: 1fr; }
    .ticket-card, .ticket-updates, .sidebar-card { padding: $spacing-4; }
    .updates-timeline .update-item { padding: $spacing-3 0 $spacing-3 $spacing-4; margin-left: $spacing-1;
      &:before { left: -6.5px; top: $spacing-3; }
      .update-header { flex-direction: column; align-items: flex-start; gap: $spacing-1; }
    }
    .form-actions { flex-direction: column; button { width: 100%; margin-bottom: $spacing-2; } }
  }
}

